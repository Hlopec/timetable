javascript:
  function redirectToClosestStop(position) {
    $.ajax({
      url: "api/closest",
      data: { longitude: position.coords.longitude, latitude: position.coords.latitude, accuracy: position.coords.accuracy }
    }).done(function(data) {
      $('img#spinner').hide()
      if(1 == data.length) {
        window.location.pathname = 'stops/' + data[0].code;  
      }
      else {
        $('div#map').html(data.map(function(item){ return '<a href="stops/'+ item.code +'">'+ item.name +'</a>' }).join('<br />') + '<br /> Точність: ' + position.coords.accuracy + 'м' ).css({'padding-bottom' : '15px'})
      }
    }).fail(function(data){
      message = 'Some temporary problemns...';
      if(404 == data.status) {
        message = 'No stop near you, sorry :(';
      }
      alert(message);
    })
  }

  $(document).ready(function() { 
    if(navigator.geolocation) {
      $('div#geo-available').show()
    }

    $('a#geo-lnk').click(function(){
      $('div#map').html('')
      $('img#spinner').show();
      navigator.geolocation.getCurrentPosition(redirectToClosestStop);
      return false;
    });
    
    $('form#stop-code-form').submit(function(){
      code = $('input#stop-code').val()
      if(code) {
        window.location.pathname = 'stops/' + code;
      }
      return false;
    })

  });
  

body style="text-align: center"
  div#geo-available style="display: none"
    p
      a#geo-lnk href=""
        | Геолокація
      img#spinner style="margin: 6px 0 0 15px; display: none" width="15px" src="https://i1.wp.com/cdnjs.cloudflare.com/ajax/libs/galleriffic/2.0.1/css/loader.gif"

    div#map

    p
      | ... або ...



  div
    form#stop-code-form
      label for="stop-code"
        | Код зупинки
      br
      input#stop-code style="width: 50px; margin: 15px 0 15px 0"
      br
      input type="submit" value=">" style="width: 50px"